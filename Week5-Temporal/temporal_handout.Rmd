---
title: 'Handout: Temporal Diversity'
author: 'Z620: Quantitative Biodiversity, Indiana University'
date: "February 10, 2017"
header-includes:
   - \usepackage{array}
output: pdf_document
geometry: margin=2.54cm
---

## OVERVIEW

In this exercise, we will explore aspects of temporal diversity. We will review ecological concepts such as community turnover/ temporal beta diversity and stability as well as statistical concepts such as autocorrelation. In addition, we will review statistical tools such as repeated measures ANOVA, autocorrelation-corrected regressionas well as the visualization tool of the Muller plot. 

## 1) SETUP
### Retrieve and Set Your Working Directory

```{r, results = 'hide'}
rm(list=ls()) 
getwd() 
#setwd("~/GitHub/QuantitativeBiodiversity/QB-2017/Week5-Temporal/") 
setwd("~/GitHub/QB-2017/Week5-Temporal/") 

```

### Install Packages

```{r, results = 'hide', warning=FALSE, message=FALSE}
install.packages("MullerPlot")
library(MullerPlot)
install.packages("tidyr", repos="http://cran.rstudio.com/") 
require("tidyr")
install.packages("dplyr", repos="http://cran.rstudio.com/") 
require("dplyr")
```

## 2) LOADING DATA

We will start by using the long-term monitoring dataset of rodents from the Chihuahuan Desert ecosystem near Portal, Arizona.

```{r}
portal <- read.table("data/combined.csv", sep = ",", header = TRUE)
```

## 3) VISUALIZING TURNOVER

First, we will create the site-by-time matrix using the packages `tidye` and `dplyr`

```{r}
# combine dates into one column
portal <- unite(portal, col = date, c(year, month, day), sep = "-")

# Create the site-by-time matrix
time.by.species <- group_by(portal, date) %>% count(species) %>% spread(key = species, value = n, fill = 0)
time.by.species <- as.data.frame(time.by.species)
head(time.by.species)

# make column 1 the row names
rownames(time.by.species) <- time.by.species[,1]
time.by.species <- time.by.species[,-c(1,2)]
head(time.by.species)
ncol(time.by.species)

# remove column of NAs and empty rows
time.by.species <- time.by.species[,-48]
time.by.species.clean <- time.by.species[-which(rowSums(time.by.species) == 0),]

time.by.species
```

Turn abundances in each row into frequencies 

```{r}
prop.table(time.by.species, 1)
sweep(time.by.species, 1, rowSums(time.by.species),`/`)
```

Let's look at a Muller plot!

```{r}
Muller_df <- get_Muller_df(example_edges, example_pop_df)
Muller_plot(Muller_df)

```
